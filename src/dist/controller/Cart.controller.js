sap.ui.define(["sap/ui/demo/cart/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/Device","sap/ui/demo/cart/model/formatter","sap/m/MessageBox"],function(e,t,r,o,i){"use strict";var n="local";var s="savedForLaterEntries";var a="cartEntries";return e.extend("sap.ui.demo.cart.controller.Cart",{formatter:o,onInit:function(){debugger;this._oRouter=this.getOwnerComponent().getRouter();this._oRouter.getRoute("comparisonCart").attachMatched(this._routePatternMatched,this)},onExit:function(){debugger;if(this._orderDialog){this._orderDialog.destroy()}if(this._orderBusyDialog){this._orderBusyDialog.destroy()}},onBack:function(){debugger;this._oRouter.navTo("productSearch")},_routePatternMatched:function(){debugger;var e=this.getModel("local");var t=e.getProperty("/cartItems");if(Object.keys(t).length>0){e.setProperty("/showProceedButton",true);e.setProperty("/showEditButton",true)}else{e.setProperty("/showProceedButton",false);e.setProperty("/showEditButton",false)}var r=this.byId("entryList");r.removeSelections();setTimeout(this.loads(this),3e3)},loads:function(){debugger;this.lastTwoDisplay(this.getView())},onCartItemDelete:function(e){var t=this;var r=e.getParameter("listItem").getModel("local").getProperty(e.getParameter("listItem").getBindingContextPath());i.confirm("Item will be deleted!",{title:"Confirm",onClose:e=>{if(e==="OK"){t.removeProductFromCart(r)}},styleClass:"sapUiSizeCompact"})},removeProductFromCart:function(e){var t=this.getOwnerComponent().getModel("local").getProperty("/cartItems");var r=this.getOwnerComponent().getModel("local").getProperty("/addedWeights");for(var o=0;o<r.length;o++){if(r[o].id===e.WeightId){r.splice(o,1);break}}for(var i=0;i<t.length;i++){if(t[i].WeightId===e.WeightId){t.splice(i,1);break}}this.getOwnerComponent().getModel("local").setProperty("/cartItems",t);this.getOwnerComponent().getModel("local").setProperty("/addedWeights",r);this.calculateOrderEstimate()},getGridItemById:function(e){debugger;var t=sap.ui.getCore().byId("__component0---productSearch--gridList").getItems();for(var r=0;r<t.length;r++){if(t[r].getBindingContextPath().indexOf(e)!=-1){return t[r]}}},getButtonInsideGrid:function(e){debugger;var t=this.getGridItemById(e);return t.getContent()[2].getItems()[0]},onEntryListPress:function(e){debugger;this._showProduct(e.getSource())},onEntryListSelect:function(e){debugger;this._showProduct(e.getParameter("listItem"))},onSaveForLater:function(e){debugger;var t=e.getSource().getBindingContext(n);this._changeList(s,a,t)},onAddBackToBasket:function(e){debugger;var t=e.getSource().getBindingContext(n);this._changeList(a,s,t)},_changeList:function(e,t,r){debugger;var o=r.getModel();var i=r.getObject();var n=o.getData();var s=Object.assign({},n[e]);var a=Object.assign({},n[t]);var g=i.ProductId;if(s[g]===undefined){s[g]=Object.assign({},i)}delete a[g];o.setProperty("/"+e,s);o.setProperty("/"+t,a)},_showProduct:function(e){debugger;var t=e.getBindingContext(n).getObject();var o=false;if(!r.system.phone){o=this.getModel("appView").getProperty("/layout").startsWith("Three")}else{o=false;this._setLayout("Two")}this._oRouter.navTo(o?"productCart":"product",{id:t.Category,productId:t.ProductId},!r.system.phone)},onCartEntriesDelete:function(e){debugger;this._deleteProduct(a,e)},onSaveForLaterDelete:function(e){debugger;this._deleteProduct(s,e)},_deleteProduct:function(e,t){debugger;var r=t.getParameter("listItem").getBindingContext(n);var o=r.getObject().ProductId;var s=this.getResourceBundle();i.show(s.getText("cartDeleteDialogMsg"),{title:s.getText("cartDeleteDialogTitle"),actions:[i.Action.DELETE,i.Action.CANCEL],onClose:function(t){debugger;if(t!==i.Action.DELETE){return}var n=r.getModel("local");var s=Object.assign({},n.getData()[e]);delete s[o];n.setProperty("/"+e,Object.assign({},s))}})},onProceedButtonPress:function(){var e=this.getOwnerComponent().getModel("local").getProperty("/cartItems");if(e.length){var t=this.getOwnerComponent().getModel("local").getProperty("/CustomerData/id");var r=new sap.ui.model.Filter("Customer","EQ","'"+t+"'");this.getView().setBusy(true);var o=this;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/OrderHeaders","GET",{filters:[r]},{},this).then(function(e){o.getOwnerComponent().getModel("local").setProperty("/orderNo",e.results.length+1);o.getView().setBusy(false);o.getRouter().navTo("checkout")}).catch(function(e){i.error("Error while fetching order no.")})}else{i.error("Cart is empty, Can't proceed")}}})});