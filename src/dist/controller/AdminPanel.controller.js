sap.ui.define(["sap/ui/demo/cart/controller/BaseController","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/f/LayoutType","sap/m/MessageToast"],function(e,t,a,s,o){"use strict";return e.extend("sap.ui.demo.cart.controller.AdminPanel",{onInit:function(){var e=this.getOwnerComponent().getRouter();e.getRoute("AdminPanel").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){var t=this;this.getView().setBusy(true);this.getModel("local").setProperty("/layout",s.TwoColumnsMidExpanded);this.firstTwoDisplay();this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/AppUsers","GET",{},{},this).then(function(e){var a=new Map;e.results.forEach(e=>{a.set(e.EmailId,{pwdChange:e.pwdChange,appUserId:e.id,lastLogin:e.lastLogin?e.lastLogin.toString().slice(4,24):"Not logged in till now"})});t.loadCustomerManufacture(a)}).catch(function(e){this.getView().setBusy(false);o.show("cannot fetch the data")})},loadCustomerManufacture:function(e){var t=this;var s=new a;var n=new a;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Manufacturers","GET",{},{},this).then(function(a){a.results.forEach((t,s)=>{if(e.has(t.EmailId)){a.results[s].pwdChange=e.get(t.EmailId).pwdChange;a.results[s].appUserId=e.get(t.EmailId).appUserId;a.results[s].lastLogin=e.get(t.EmailId).lastLogin}});s.setData(a);t.getView().setModel(s,"manufactureModelInfo")}).catch(function(e){o.show("cannot fetch the data")});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Customers","GET",{},{},this).then(function(a){a.results.forEach((t,s)=>{if(e.has(t.EmailId)){a.results[s].pwdChange=e.get(t.EmailId).pwdChange;a.results[s].appUserId=e.get(t.EmailId).appUserId;a.results[s].lastLogin=e.get(t.EmailId).lastLogin}});n.setData(a);t.getView().setModel(n,"customerModelInfo");t.getView().setBusy(false)}).catch(function(e){t.getView().setBusy(false);o.show("cannot fetch the data")})},userStatusUpdate:function(e,t,a){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),e+"('"+t+"')","PUT",{},{Status:a},this).then(function(e){o.show("Success")}).catch(function(e){o.show("Error, Invalid Data")})},onBlockSwitch:function(e){var t=e.getSource().getParent().getBindingContextPath()+"/id";var a=this.getView().getModel("customerModelInfo").getProperty(t);var s=e.getParameters("Selected").state?"U":"B";this.userStatusUpdate("/Customers",a,s)},onBlockSwitch2:function(e){var t=e.getSource().getParent().getBindingContextPath()+"/id";var a=this.getView().getModel("manufactureModelInfo").getProperty(t);debugger;var s=e.getParameters("Selected").state?"U":"B";this.userStatusUpdate("/Manufacturers",a,s)},setPasswordChange:function(e,t){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/AppUsers('"+e+"')","PUT",{},{pwdChange:true},this).then(function(e){o.show("Success, Password reseted")}).catch(function(e){o.show("Error, Invalid Data")})},onPassSwitch:function(e){var t=e.getSource().getParent().getBindingContextPath();var a=this.getView().getModel("customerModelInfo").getProperty(t+"/appUserId");var s=e.getParameters("Selected").state;if(s===false){o.show("Can't, Password is reseted!");this.getView().getModel("customerModelInfo").setProperty(t+"/pwdChange",true)}else{this.setPasswordChange(a,s)}},onPassSwitch2:function(e){var t=e.getSource().getParent().getBindingContextPath();var a=this.getView().getModel("manufactureModelInfo").getProperty(t+"/appUserId");var s=e.getParameters("Selected").state;if(s===false){o.show("Can't, Password is reseted");this.getView().getModel("manufactureModelInfo").setProperty(t+"/pwdChange",true)}else{this.setPasswordChange(a,s)}}})});