sap.ui.define(["sap/ui/demo/cart/controller/BaseController","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","sap/ui/demo/cart/model/formatter","sap/m/MessageToast","sap/ui/model/Filter"],function(e,t,o,a,r,n,i){"use strict";return e.extend("sap.ui.demo.cart.controller.Group",{formatter:r,onInit:function(){var e,t=new o({groupCode:"",groupName:"",description:""});this.setModel(t,"groupModel");var a=new o({buttonText:"Save",deleteEnabled:false});this.setModel(a,"viewModel");var r=this.getRouter();r.getRoute("Group").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(){var e=this;this.getView().setBusy(true);this.loadCategories();var t=this.getView().getModel("viewModel");t.setProperty("/codeEnabled",true);t.setProperty("/buttonText","Save");t.setProperty("/deleteEnabled",false);var a=new o({groupCodeState:"None"});this.setModel(a,"dataModel");var r=new o;var i=new o;this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Customers","GET",{},{},this).then(function(t){r.setData(t);e.getView().setModel(r,"customerModelInfo")}).catch(function(e){n.show("cannot fetch the data")});this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups","GET",{},{},this).then(function(t){i.setData(t);e.getView().setModel(i,"groupModelInfo");e.getView().setBusy(false)}).catch(function(t){e.getView().setBusy(false);n.show("cannot fetch the data")});this.clearGroup();this.firstTwoDisplay()},toggleFullScreen:function(){debugger;var e="idFullScreenBtn";var t="__component0---idGroup--GroupHeader";this.toggleUiTable(e,t)},additionalInfoValidation:function(){var e=this.getView().getModel("groupModel");var t=this.getView().getModel("dataModel");if(e.getData().groupCode===""){t.setProperty("/groupCodeState","Error")}else{t.setProperty("/groupCodeState","None")}},groupCodeCheck:function(e){var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var a=this.getView().getModel("groupModelInfo").getData().results;var r=this.getView().getModel("viewModel");function n(e){return a.filter(function(t){return t.groupCode===e})}var i=n(o);if(i.length>0){t.getData().groupName=i[0].groupName;t.getData().description=i[0].description;r.setProperty("/buttonText","Update");r.setProperty("/deleteEnabled",true);r.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("groupName").focus();t.refresh()}else{t.getData().groupName="";t.getData().description="";r.setProperty("/buttonText","Save");r.setProperty("/deleteEnabled",false);r.setProperty("/codeEnabled",false);this.additionalInfoValidation();this.getView().byId("groupName").focus();t.refresh()}},clearGroup:function(){var e=this.getView().getModel("groupModel");var t=this.getView().getModel("viewModel");var o=this.getView().getModel("dataModel");e.getData().groupName="";e.getData().description="";e.getData().groupCode="";t.setProperty("/codeEnabled",true);t.setProperty("/buttonText","Save");t.setProperty("/deleteEnabled",false);o.setProperty("/groupCode","None");e.refresh()},deleteGroup:function(){var e=this;var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var a=this.getView().getModel("groupModelInfo").getData().results;function r(e){return a.filter(function(t){return t.groupCode===e})}var i=r(o);if(i.length>0){if(!this.customerGroupInfo(i[0].groupName)){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups('"+i[0].id+"')","DELETE",{},{},this).then(function(o){n.show("Deleted successfully");t.getData().groupCode="";t.getData().groupName="";t.getData().description="";t.refresh();e._onRouteMatched()}).catch(function(e){n.show("Could not delete the entry")})}else{n.show("Group already in use.Cannot be deleted")}}else{n.show("Data not available")}},customerGroupInfo:function(e){var t=this.getView().getModel("customerModelInfo");var o=t.getData().results;function a(t){return o.filter(function(t){return t.Group===e})}var r=a(e);if(r.length>0){return true}else{return false}},saveGroup:function(){var e=this;var t=this.getView().getModel("groupModel");var o=t.getData().groupCode;var a=this.getView().getModel("groupModelInfo").getData().results;if(o===""){this.additionalInfoValidation();n.show("Please fill the required fields");return}function r(e){return a.filter(function(t){return t.groupCode===e})}var i=r(o);if(i.length>0){this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Groups('"+i[0].id+"')","PUT",{},t.getData(),this).then(function(t){n.show("Data saved successfully");e._onRouteMatched()}).catch(function(e){n.show("Data could not be saved")})}else{this.ODataHelper.callOData(this.getOwnerComponent().getModel(),"/Group","POST",{},t.getData(),this).then(function(t){n.show("Data saved successfully");e._onRouteMatched()}).catch(function(e){n.show("Data could not be saved")})}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("group",{Id:t});this._bindView("/"+e)}.bind(this))},getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},_bindView:function(e){var t=this.getModel("objectView"),o=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){o.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),o=e.getElementBinding();if(!o.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var a=this.getResourceBundle(),r=e.getBindingContext().getObject(),n=r.Id,i=r.FirstName;t.setProperty("/busy",false);t.setProperty("/saveAsTileTitle",a.getText("saveAsTileTitle",[i]));t.setProperty("/shareOnJamTitle",i);t.setProperty("/shareSendEmailSubject",a.getText("shareSendEmailObjectSubject",[n]));t.setProperty("/shareSendEmailMessage",a.getText("shareSendEmailObjectMessage",[i,n,location.href]))}})});